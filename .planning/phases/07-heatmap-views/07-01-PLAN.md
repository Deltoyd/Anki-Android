# Plan 07-01: Heatmap Views (Week, Month, Year)

## Summary

Add tabbed heatmap views to the StreakBottomSheet: Week (7-day circles), Month (calendar grid), and Year (compact dot heatmap). Each view shows study intensity using the #d36b52 color family and displays total study time for that period.

## Requirements Addressed

- WEEK-01: 7 rounded day circles (M-S) in Week tab
- WEEK-02: Gray unstudied, #d36b52 shades for studied
- WEEK-03: Current day highlighted
- MNTH-01: Month tab with calendar grid
- MNTH-02: Calendar days colored by intensity
- MNTH-03: Current day highlighted with ring
- MNTH-04: Monthly study time displayed
- YEAR-01: Year tab with compact dot heatmap
- YEAR-02: Dots colored by intensity
- YEAR-03: Yearly study time displayed

## Dependencies

- Phase 6: StreakBottomSheet exists with placeholder for heatmap
- StudyTrackingRepository: getDailyStudyData(), calculateIntensity(), computeDailyAverage(), getStudyTimeForPeriod()
- MuseumViewModel: Already loads 365 days of dailyData

## Technical Approach

### Data Flow

1. **MuseumViewModel** exposes `dailyStudyData: Map<LocalDate, DailyStudyData>` in MuseumUiState
2. **StreakBottomSheet** collects this map and computes view-specific data
3. Each tab filters the data for its time range and renders accordingly

### UI Components

1. **TabLayout** with 3 tabs: Week | Month | Year
2. **ViewPager2** or simple view switching for tab content
3. Custom views for each visualization:
   - **WeekHeatmapView**: 7 horizontal circles with day labels
   - **MonthHeatmapView**: Calendar grid (7 columns × 4-6 rows)
   - **YearHeatmapView**: 52-column × 7-row dot grid (GitHub-style)

### Color Palette (#d36b52 family)

| Intensity | Color | Description |
|-----------|-------|-------------|
| NONE | #E8E8E8 | Gray - unstudied |
| LEVEL_1 | #F5D6CF | Very light - <= 0.5x avg |
| LEVEL_2 | #EBB8AD | Light - <= 1.0x avg |
| LEVEL_3 | #E19A8B | Medium - <= 1.5x avg |
| LEVEL_4 | #D77C69 | Strong - <= 2.0x avg |
| LEVEL_5 | #D36B52 | Full - > 2.0x avg |

### File Changes

**Create:**
- `AnkiDroid/src/main/java/com/ichi2/anki/ui/museum/heatmap/WeekHeatmapView.kt`
- `AnkiDroid/src/main/java/com/ichi2/anki/ui/museum/heatmap/MonthHeatmapView.kt`
- `AnkiDroid/src/main/java/com/ichi2/anki/ui/museum/heatmap/YearHeatmapView.kt`
- `AnkiDroid/src/main/res/layout/view_heatmap_week.xml`
- `AnkiDroid/src/main/res/layout/view_heatmap_month.xml`
- `AnkiDroid/src/main/res/layout/view_heatmap_year.xml`

**Modify:**
- `AnkiDroid/src/main/res/layout/bottomsheet_streak.xml` - Add TabLayout + ViewFlipper
- `AnkiDroid/src/main/java/com/ichi2/anki/ui/museum/StreakBottomSheet.kt` - Wire tabs + populate views
- `AnkiDroid/src/main/java/com/ichi2/anki/ui/museum/MuseumViewModel.kt` - Expose dailyStudyData in state
- `AnkiDroid/src/main/res/values/colors.xml` - Add intensity color palette
- `AnkiDroid/src/main/res/values/02-strings.xml` - Add tab labels + time format strings

## Implementation Steps

### Step 1: Add intensity colors to palette

Add 6 colors for intensity levels in colors.xml.

### Step 2: Expose dailyStudyData from ViewModel

Add `dailyStudyData: Map<LocalDate, DailyStudyData>` to MuseumUiState so heatmap views can compute intensities.

### Step 3: Update StreakBottomSheet layout

Replace placeholder with:
- TabLayout (Week | Month | Year)
- ViewFlipper containing 3 heatmap views
- Study time TextView below each view

### Step 4: Create WeekHeatmapView

Custom View that renders 7 horizontal circles:
- Each circle: 40dp diameter
- Day label below (M, T, W, T, F, S, S)
- Current day: thicker stroke ring
- Color by intensity

### Step 5: Create MonthHeatmapView

Custom View that renders calendar grid:
- 7 columns (Mon-Sun)
- 4-6 rows depending on month
- Each cell: 32dp circle
- Current day: stroke ring
- Leading/trailing days from adjacent months in lighter shade

### Step 6: Create YearHeatmapView

Custom View that renders GitHub-style heatmap:
- 53 columns (weeks) × 7 rows (days)
- Each cell: 10dp dot with 2dp gap
- Color by intensity
- Scrollable horizontally if needed

### Step 7: Wire StreakBottomSheet

- Tab selection switches ViewFlipper
- Collect dailyStudyData and compute per-view data
- Update study time label per tab

### Step 8: Add string resources

Tab labels and time format strings.

## Success Criteria

1. Week tab shows 7 circles colored by intensity with current day highlighted
2. Month tab shows calendar grid with circles colored by intensity, current day ring
3. Year tab shows compact dot heatmap colored by intensity
4. Each tab displays total study time for that period
5. Build compiles successfully
6. Tab switching is smooth

## Verification

```bash
./gradlew :AnkiDroid:compilePlayDebugKotlin
```

Check files exist:
- WeekHeatmapView.kt
- MonthHeatmapView.kt  
- YearHeatmapView.kt
- Updated bottomsheet_streak.xml with TabLayout

## Estimated Complexity

- Custom views: Medium-High (coordinate calculations)
- Data integration: Low (existing infrastructure)
- Tab wiring: Low (standard Material component)

Total: ~1 hour execution time
